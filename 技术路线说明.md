# 屏幕活动分析系统 技术路线说明（现状对齐版）

## 目标与原则
- 以“本地优先、隐私优先”为前提，保证低成本、低心智负担的使用体验
- 能持续运行、可解释、可回顾，且对配置与迁移友好
- 在 Obsidian 生态内可沉淀为可搜索、可链接、可复用的知识资产

## 当前架构（与代码一致）
```
screen-analyzer/
├── src-tauri/                 # Rust 后端
│   ├── src/
│   │   ├── capture/           # 截屏与调度
│   │   ├── video/             # 视频生成与处理
│   │   ├── analysis/          # 视频分析与批处理
│   │   ├── llm/               # Qwen / Claude / Codex 提供商
│   │   ├── storage/           # SQLite/MariaDB、清理与缓存
│   │   ├── notion/            # Notion 同步
│   │   ├── domains/           # 领域封装（capture/analysis/storage/system）
│   │   ├── actors/            # 后台任务与调度协作
│   │   ├── utils/             # 工具与校验
│   │   └── lib.rs             # Tauri 命令与全局状态
├── src/                       # Vue 3 前端
│   ├── components/            # 视图组件
│   ├── stores/                # Pinia 状态
│   └── App.vue
└── *.md                      # 项目说明文档
```

## 核心模块现状
- 截屏与会话：`src-tauri/src/capture` 负责多屏截图、分辨率与黑屏检测
- 视频生成：`src-tauri/src/video` 负责合成回放与抽帧策略
- 分析链路：`src-tauri/src/analysis` 提供视频分析、批处理与重试
- LLM 集成：`src-tauri/src/llm` 支持 Qwen、Claude、Codex CLI，带可配置提示词
- 存储管理：`src-tauri/src/storage` 支持 SQLite/MariaDB、清理策略、统计
- 同步与扩展：`src-tauri/src/notion` 支持 Notion 会话同步
- 前端体验：`src/` 内完成时间线、会话详情、设置与监控

## 阶段路线（建议）
### 阶段一：对齐与规划（进行中）
- 对齐文档与代码现状，补齐路线说明
- 定义 Obsidian 导出协议与模板
- 定义配置迁移与换机流程

### 阶段二：Obsidian MVP
- 导出每日总结与会话 Markdown（已实现）
- 生成稳定的 Frontmatter 与目录结构（已实现）
- 可配置导出路径与链接策略（已实现）

### 阶段三：深度与智能
- 聚合式周报/月报与主题索引（已实现月度索引）
- 上下文切换/专注度/碎片化指标
- 可视化索引与知识回链

## Obsidian 集成策略（混合式）
- 先实现 Markdown 导出，保证“可见、可查、可链接”
- 预留后续插件协议（索引文件、元数据与链接策略）
- 默认不复制大文件，仅写入链接，避免 Vault 膨胀

## 配置迁移策略
- 以“配置包导出/导入”为主，支持显式选择是否包含密钥
- 记录版本号与字段演进，保证向后兼容
- 提供“便携模式”规划：将配置放入 Vault 或指定目录

## 风险与控制
- 性能：采样与分段控制 LLM 成本，保证长时间运行稳定
- 隐私：默认本地存储，导出时避免自动带出敏感信息
- 兼容：跨平台路径与 FFmpeg 依赖需持续验证

## 关联文档
- `Obsidian集成方案.md`
- `配置迁移方案.md`
- `AI_DEV_CHECKLIST.md`
- `开发记录.md`
