# 开发记录

## 记录模板
- 日期:
- 目标:
- 变更:
- 验证:
- 风险:
- 下一步:

## 2026-01-15 阶段一启动
- 目标: 对齐文档与代码现状，给出 Obsidian 与配置迁移方案
- 变更:
  - 更新说明文档与路线文档
  - 新增 Obsidian 集成与配置迁移方案文档
  - 修正示例配置文件为有效 JSON
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 文档与实现可能仍有细节偏差，需要后续继续核对
- 下一步: 进入 Obsidian 导出 MVP 设计与实现

## 2026-01-15 阶段二完成
- 目标: 完成 Obsidian 导出 MVP（每日/会话 Markdown）
- 变更:
  - 后端新增 Obsidian 导出模块与导出命令
  - 配置模型新增 Obsidian 导出配置字段
  - 前端设置页新增 Obsidian 导出配置与导出入口
  - 顶栏 Export 按钮接入 Obsidian 导出
  - 文档更新 Obsidian 导出说明
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: Windows 文件路径与 Vault 权限需人工验证
- 下一步: 进入阶段三（统计/专注度指标与索引增强）

## 2026-01-15 阶段三推进
- 目标: 增强 Obsidian 索引，输出月度汇总
- 变更:
  - 导出时自动生成月度索引文件（Index/sessions-YYYY-MM.md）
  - 汇总月度会话数、总时长与主要类别
  - 会话导出增加碎片化指标与上下文切换统计
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 月度统计依赖数据库活动聚合结果，需人工校验准确性
- 下一步: 进入阶段三后续（专注度/碎片化指标与周报）

## 2026-01-15 阶段四推进
- 目标: 完成配置迁移导出/导入，支持换机快速恢复
- 变更:
  - 后端新增配置导出/导入命令与密钥剥离逻辑
  - 前端设置页新增“配置迁移”入口与导出/导入流程
  - 文档更新配置迁移使用说明与路线状态
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 导入后 LLM/数据库连接需手动测试，必要时重启应用
- 下一步: 进入阶段三深度指标与周报扩展

## 2026-01-15 阶段四便携
- 目标: 支持便携模式与快速换机
- 变更:
  - 启动时读取配置路径指针与环境变量
  - 新增便携路径设置与恢复默认命令
  - 设置页新增便携模式入口与当前路径提示
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 便携路径变更需重启生效，用户需注意路径权限
- 下一步: 评估评分权重配置与前端可视化

## 2026-01-15 阶段三补充
- 目标: 增强 Obsidian 周度索引，补齐周报聚合能力
- 变更:
  - 导出日记时同步生成周度索引文件（Index/weeks-YYYY-Www.md）
  - 汇总周度会话数、总时长、主要类别与每日明细表
  - 导出提示追加周索引路径
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 周度范围按 ISO 周计算，跨年周需要人工校验
- 下一步: 评估专注度/生产力评分与周报摘要

## 2026-01-15 阶段三深化
- 目标: 在周度索引中补充专注度与分心度指标
- 变更:
  - 基于时间线卡片时长计算周度专注/分心时长与占比
  - 周度索引 Frontmatter 增加专注度字段
  - 周度索引新增专注度汇总段落
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 时间线卡片为空时专注度为 0，需要注意解释
- 下一步: 评估周报摘要文本与生产力评分规则

## 2026-01-15 阶段三延展
- 目标: 输出可读的周报聚合文件，便于 Obsidian 回顾
- 变更:
  - 新增 Weekly 目录周报文件（Weekly/YYYY-Www.md）
  - 周报包含概览、专注度、每日要点与索引链接
  - 周报每日要点基于已有的每日总结记录
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 如果数据库无每日总结记录，周报将显示占位说明
- 下一步: 评估生产力评分规则与周报摘要优化

## 2026-01-15 阶段三评分
- 目标: 为周报添加可解释的生产力评分
- 变更:
  - 周报与周度索引新增专注评分、投入时长评分与生产力评分字段
  - 评分规则基于专注占比与投入时长的加权计算
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 时间线卡片缺失时评分会偏低，需要结合上下文理解
- 下一步: 评估评分权重与可视化呈现方式

## 2026-01-15 阶段三权重
- 目标: 支持周报评分权重与目标时长可配置
- 变更:
  - Obsidian 设置新增专注权重与周目标时长
  - 周度索引与周报使用配置权重计算评分
  - Frontmatter 记录评分权重与目标时长
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 权重设置不当会影响评分解释，需要提示用户
- 下一步: 评估评分权重的可视化展示

## 2026-01-15 阶段三摘要
- 目标: 输出规则化的周报摘要，便于快速回顾
- 变更:
  - 周报新增摘要段落，基于专注度/投入时长/会话时长生成提示
  - 周报摘要默认覆盖专注度、生产力与碎片化倾向
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 规则摘要无法替代人工判断，仅供参考
- 下一步: 评估摘要规则权重与 UI 可视化

## 2026-01-15 阶段三索引
- 目标: 增强 Obsidian 导出导航体验
- 变更:
  - 新增 overview.md，总览最新日/周/月索引链接
  - 总览文件包含更新时间戳与快速入口
- 验证: 未运行测试（按仓库要求仅编译测试，不执行，本次未执行）
- 风险: 总览依赖周报数据生成，需保证导出流程顺序
- 下一步: 评估总览在前端的展示方式

## 2026-01-17 阶段四调度
- 目标: 让截屏暂停/恢复真正生效，并支持动态更新截屏/会话间隔
- 变更:
  - 调度器使用原子配置，支持动态更新截屏间隔与会话时长
  - 切换截屏状态时同步更新调度器启停
  - README 更新便携模式状态与后续路线
- 验证: cargo test --no-run
- 风险: 暂停状态下仍会扫描既有图片窗口，需注意行为预期
- 下一步: 增加 Obsidian 可视化总览入口与周报卡片

## 2026-01-17 阶段五 Obsidian 入口
- 目标: 在主界面提供 Obsidian 总览/周报快捷入口
- 变更:
  - 后端新增 Obsidian 路径预览命令（不触发导出）
  - 总结面板新增 Obsidian 快捷区块与导出/打开按钮
  - README 更新 Obsidian 快捷入口状态
- 验证: cargo test --no-run
- 风险: 路径未生成时仍可尝试打开，需提示用户先导出
- 下一步: 评估月度摘要刷新与 LLM 提供商列表接口

## 2026-01-17 阶段六 LLM 列表
- 目标: 补齐 LLM 提供商列表接口
- 变更:
  - 后端新增 get_llm_providers 命令
  - 前端使用真实提供商列表并提供失败回退
- 验证: cargo test --no-run
- 风险: 列表仅反映当前内置提供商，扩展后需同步更新
- 下一步: 评估月度摘要刷新与会话汇总可视化

## 2026-01-17 阶段七 周报评分卡
- 目标: 在 Obsidian 快捷区块展示周报评分与关键指标
- 变更:
  - Obsidian 导出模块新增周报预览数据结构与计算入口
  - Obsidian 预览命令返回周报评分与核心指标
  - 总结面板展示专注占比、投入评分、生产力评分与周时长
  - README 更新 Obsidian 快捷入口描述
- 验证: cargo test --no-run
- 风险: 周报指标依赖日总结与时间线数据，缺失时可能偏低
- 下一步: 评估月度摘要刷新与 Notion 视频上传策略

## 2026-01-17 阶段八 月度概览
- 目标: 在主界面补齐月度摘要与刷新逻辑
- 变更:
  - 主界面刷新与日期切换时同步拉取当月活动统计
  - 总结面板新增本月概览卡片（会话数、总时长、主要类别）
  - README 更新月度概览说明
- 验证: cargo test --no-run
- 风险: 月度统计依赖活动聚合数据，跨月切换需注意性能
- 下一步: 评估 Notion 视频上传策略与月度总结导出
